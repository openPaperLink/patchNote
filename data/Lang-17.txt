The bug is caused by the incorrect calculation of the `len` variable using `Character.codePointCount(input, 0, input.length())`, which miscounts characters when surrogate pairs are involved. This results in translation errors and mishandling of surrogate pairs, leading to incorrect or partial translations, as highlighted in the `testLang720` test case. This test case uses input with a surrogate pair and a regular character, expecting `StringEscapeUtils.escapeXml(input)` to match `input`, but the bug results in a failure. The fix involves setting `len` to `input.length()`, which correctly counts the number of `char` units, and updating `pos` with `pos += c.length` to ensure accurate character processing in the loop.